<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ìš°ë¦¬ë‚˜ë¼ ì§€ë„ ìƒ‰ì¹ í•˜ê¸°</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    html, body { height:100vh; margin:0; padding:0; background:#ffffff; }
    body { display:flex; flex-direction:column; }
    #map { flex:1; }
    #map { height:70%; margin:0; padding:0; background:#ffffff; }
    body { display:flex; flex-direction:column; }
    header { background:rgb(156, 218, 230); color:#fff; padding:10px; text-align:left; font-size:18px; }
    #toolbar { background:#f8f8f8; padding:8px; display:flex; flex-wrap:wrap; gap:12px; align-items:center; border-bottom:1px solid #ddd; font-family:sans-serif; }
    #toolbar button, #toolbar select, #toolbar input[type=color] { border:1px solid #ccc; background:white; border-radius:4px; padding:4px 8px; cursor:pointer; transition:background .2s, color .2s; }
    #btn-sg.mode-sg { background:#007bff; color:#fff; font-weight:bold; border-color:#007bff; }
    #btn-sg.mode-sg:hover { background:#0056b3; }
    #btn-sg.mode-sd { background:#dc3545; color:#fff; font-weight:bold; border-color:#dc3545; }
    #btn-sg.mode-sd:hover { background:#c82333; }
    #toolbar .palette-box { width:20px; height:20px; border:1px solid #aaa; cursor:pointer; transition:transform .15s, border-color .15s; }
    #toolbar .palette-box:hover { transform:scale(1.2); border-color:#333; }
    #toolbar label { font-size:0.9rem; display:flex; align-items:center; gap:2px; }
    #toolbar span.value { min-width:20px; text-align:right; display:inline-block; }
    #toolbar input[type=range] { width:100px; }
    .leaflet-control-zoom { display:none; }
    #map.animated-fade { 
      transition: opacity 0.4s cubic-bezier(.4,0,.2,1); 
      opacity: 0.25; 
      pointer-events: none;
    }
    #map.animated-fade-in {
      transition: opacity 0.4s cubic-bezier(.4,0,.2,1); 
      opacity: 1;
      pointer-events: auto;
    }
    @media (max-width: 700px) {
      header { font-size: 15px; padding: 8px; }
      #toolbar { flex-wrap: wrap; gap: 8px; padding: 6px; font-size: 0.95em; overflow-x: auto; }
      #toolbar button, #toolbar select, #toolbar input[type=color] { padding: 6px 10px; font-size: 1em; min-width: 36px; }
      #toolbar label { flex-direction: column; align-items: flex-start; gap: 0; margin-bottom: 4px; }
      #toolbar .palette-box { width: 28px; height: 28px; margin-bottom: 2px; }
      #toolbar-zoom { flex-direction: row; min-width: 70px; }
      #map { height: 62vh; min-height: 200px; }
    }
    @media (max-width: 480px) {
      header { font-size: 12px; padding: 6px; }
      #toolbar { font-size: 0.88em; gap: 5px; padding: 4px; }
      #toolbar .palette-box { width: 22px; height: 22px; }
      #map { height: 54vh; min-height: 120px; }
    }
    .leaflet-interactive:focus {
      outline: none !important;
      box-shadow: none !important;
    }
    /* ì»¤ìŠ¤í…€ íˆ´íŒ ìŠ¤íƒ€ì¼ */
    .map-custom-tooltip {
      position: fixed;
      pointer-events: none;
      background: rgba(255,255,255,0.97);
      border: 1.5px solid #333;
      border-radius: 6px;
      padding: 5px 16px;
      font-size: 17px;
      font-family: 'Noto Sans KR', sans-serif;
      color: #222;
      white-space: nowrap;
      box-shadow: 2px 4px 12px rgba(0,0,0,0.09);
      z-index: 9999;
      transition: opacity .1s;
      opacity: 0;
      pointer-events: none;
    }
    .map-custom-tooltip.visible {
      opacity: 1;
    }
  </style>
</head>
<body>
  <header>ìš°ë¦¬ë‚˜ë¼ ì§€ë„ ìƒ‰ì¹ í•˜ê¸° ğŸ—ºï¸ğŸ–Œï¸ğŸºğŸ—ğŸ¤ª v1.0 20250627</header>
  <div id="toolbar">
    <button id="btn-sg" class="mode-sg" aria-label="ì‹œêµ°/ì‹œë„ ëª¨ë“œ í† ê¸€" title="ì‹œêµ°/ì‹œë„ ëª¨ë“œ í† ê¸€">ì‹œêµ°</button>
    <label>ìƒ‰ìƒ:<input type="color" id="colorPicker" value="#FFD700" aria-label="ìƒ‰ìƒ ì„ íƒ"></label>
    <div id="paletteButtons" style="display:flex; gap:4px;">
      <div class="palette-box" id="palette-custom" data-color="#444444" style="background:#444444" title="ìƒ‰ìƒ #444444"></div>
      <div class="palette-box" data-color="#777777" style="background:#777777" title="ìƒ‰ìƒ #777777"></div>
      <div class="palette-box" data-color="#aaaaaa" style="background:#aaaaaa" title="ìƒ‰ìƒ #aaaaaa"></div>
      <div class="palette-box" data-color="#dddddd" style="background:#dddddd" title="ìƒ‰ìƒ #dddddd"></div>
      <div class="palette-box" data-color="#f0f0f0" style="background:#f0f0f0" title="ìƒ‰ìƒ #f0f0f0"></div>
    </div>
    <!-- ìœ¡ì§€ ìƒ‰ìƒ ë“œë¡­ë°•ìŠ¤ ì™„ì „íˆ ì œê±° -->
    <label>ì‹œë„ ê²½ê³„ êµµê¸°:<input type="range" id="slider-sd" min="1" max="10" step="0.5" value="1" aria-label="ì‹œë„ ê²½ê³„ êµµê¸° ì„ íƒ"><span class="value" id="sd-value">1.0</span>px</label>
    <label>ì‹œêµ° ê²½ê³„ êµµê¸°:<input type="range" id="slider-sg" min="0.5" max="10" step="0.5" value="0.5" aria-label="ì‹œêµ° ê²½ê³„ êµµê¸° ì„ íƒ"><span class="value" id="sg-value">0.5</span>px</label>
    <button id="btn-base" aria-label="ë°°ê²½ì§€ë„ ì¼œê¸°/ë„ê¸°" title="ë°°ê²½ì§€ë„ ì¼œê¸°/ë„ê¸°">ğŸŒš ë°°ê²½ì§€ë„</button>
    <div id="toolbar-zoom" style="display:flex; border:1px solid #ccc; border-radius:4px; overflow:hidden;">
      <button id="zoom-in" aria-label="í™•ëŒ€" title="í™•ëŒ€(+0.1)" style="border:none; padding:4px 8px; background:white; cursor:pointer;">+</button>
      <button id="zoom-out" aria-label="ì¶•ì†Œ" title="ì¶•ì†Œ(-0.1)" style="border:none; padding:4px 8px; background:white; cursor:pointer;">â€“</button>
    </div>
    <button id="btn-reset" aria-label="ì´ˆê¸°í™”" title="ì´ˆê¸°í™”">ì´ˆê¸°í™”</button>
    <button id="savePng" aria-label="PNG ì €ì¥" title="PNG ì €ì¥">PNG ì €ì¥</button>
    <label>í™•ëŒ€ ë ˆë²¨:<span id="zoom-level">6.5</span></label>
  </div>
  <div id="map"></div>
  <!-- ì»¤ìŠ¤í…€ íˆ´íŒìš© div ì¶”ê°€ -->
  <div id="map-custom-tooltip" class="map-custom-tooltip"></div>
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    // --- ì»¤ìŠ¤í…€ íˆ´íŒ ë¡œì§ ---
    const tooltipDiv = document.getElementById('map-custom-tooltip');
    function showCustomTooltip(html, event) {
      tooltipDiv.innerHTML = html;
      tooltipDiv.classList.add('visible');
      // ë§ˆìš°ìŠ¤ ì¢Œí‘œì— íˆ´íŒ ìœ„ì¹˜(ì‚´ì§ ìš°ìƒë‹¨ìœ¼ë¡œ)
      const offsetX = 15, offsetY = 8;
      // eventëŠ” leafletì˜ MouseEvent (originalEventë¡œ ì ‘ê·¼)
      const clientX = event.originalEvent.clientX, clientY = event.originalEvent.clientY;
      tooltipDiv.style.left = (clientX + offsetX) + 'px';
      tooltipDiv.style.top  = (clientY + offsetY) + 'px';
    }
    function hideCustomTooltip() {
      tooltipDiv.classList.remove('visible');
    }

    // --- ì „ì—­ ë³€ìˆ˜ ë° ì´ˆê¸°í™” ---
    const initialCenter = [36.5, 127.8], initialZoom = 6.5;
    const map = L.map('map', {
      center: initialCenter,
      zoom: initialZoom,
      zoomSnap: 0,
      zoomDelta: 0.1,
      zoomControl: false,
      attributionControl: false
    });

    let baseOn = false;
    const baseLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 19 });
    const btnBase = document.getElementById('btn-base');

    let highlightFill = '#FFD700',
        sgVisible = true,
        defaultLandOpacity = 0.3;

    const defaultStyle = {
      sd: { color: '#444', weight: 1, fillColor: '#ffffff', fillOpacity: defaultLandOpacity, opacity: 1 },
      sg: { color: '#444', weight: 0.5, fillOpacity: 0, opacity: 1 }
    };

    const coloredSd = new Map(),
          coloredSg = new Map();
    let sdLayer, sgLayer, sdBorderLayer;

    // --- íˆ´ë°”: íŒ”ë ˆíŠ¸/ì»¬ëŸ¬í”¼ì»¤ ë™ê¸°í™” ---
    document.querySelectorAll('.palette-box').forEach(b => b.addEventListener('click', () => {
      highlightFill = b.dataset.color;
      document.getElementById('colorPicker').value = highlightFill;
    }));

    document.getElementById('colorPicker').addEventListener('input', e => {
      highlightFill = e.target.value;
      const customBox = document.getElementById('palette-custom');
      customBox.dataset.color = highlightFill;
      customBox.style.background = highlightFill;
      customBox.title = `ìƒ‰ìƒ ${highlightFill}`;
    });

    // --- íˆ´ë°”: ì§€ë„ í™•ëŒ€/ì¶•ì†Œ ---
    document.getElementById('zoom-in').addEventListener('click', () => map.zoomIn(0.1));
    document.getElementById('zoom-out').addEventListener('click', () => map.zoomOut(0.1));
    map.on('zoomend', () => document.getElementById('zoom-level').textContent = map.getZoom().toFixed(1));

    // --- íˆ´ë°”: ë² ì´ìŠ¤ë§µ í† ê¸€ ---
    btnBase.addEventListener('click', () => {
      baseOn = !baseOn;
      if (baseOn) {
        map.addLayer(baseLayer);
        btnBase.textContent = 'ğŸŒ ë°°ê²½ì§€ë„';
      } else {
        map.removeLayer(baseLayer);
        btnBase.textContent = 'ğŸŒš ë°°ê²½ì§€ë„';
      }
    });

    // --- í•´ì–‘ ì˜ì—­(ë°±ê·¸ë¼ìš´ë“œ í°ìƒ‰) ---
    map.createPane('seaPane');
    map.getPane('seaPane').style.zIndex = 100;
    L.rectangle([[-90, -180], [90, 180]], {
      pane: 'seaPane',
      interactive: false,
      fillColor: '#ffffff',
      fillOpacity: 1,
      stroke: false
    }).addTo(map);

    // --- ìŠ¤íƒ€ì¼ í•¨ìˆ˜ ---
    function getSdStyle(layer) {
      const id = layer._leaflet_id;
      if (coloredSd.get(id)) {
        return {
          color: '#444',
          weight: 2,
          fillColor: highlightFill,
          fillOpacity: 0.7,
          opacity: 1
        };
      } else {
        return {
          ...defaultStyle.sd
        };
      }
    }
    function getSgStyle(layer) {
      const id = layer._leaflet_id;
      if (coloredSg.get(id)) {
        return {
          color: '#444',
          weight: 1,
          fillColor: highlightFill,
          fillOpacity: 0.7,
          opacity: 1
        };
      } else {
        return {
          ...defaultStyle.sg
        };
      }
    }

    // --- ìƒ‰ì¹  í† ê¸€ í•¨ìˆ˜ ---
    function toggleSdLayerColor(layer) {
      const id = layer._leaflet_id;
      const on = !coloredSd.get(id);
      coloredSd.set(id, on);
      layer.setStyle(getSdStyle(layer));
    }
    function toggleSgLayerColor(layer) {
      const id = layer._leaflet_id;
      const on = !coloredSg.get(id);
      coloredSg.set(id, on);
      layer.setStyle(getSgStyle(layer));
    }

    // --- ìƒ‰ìƒ ì¼ê´„ ì´ˆê¸°í™” í•¨ìˆ˜ ---
    function resetSdLayerColors() {
      coloredSd.clear();
      sdLayer.eachLayer(layer => layer.setStyle(getSdStyle(layer)));
    }
    function resetSgLayerColors() {
      coloredSg.clear();
      sgLayer.eachLayer(layer => layer.setStyle(getSgStyle(layer)));
    }

    // --- ê°•ì¡°íš¨ê³¼(í˜ì´ë“œ) í•¨ìˆ˜ ---
    function animateMapFade(cb) {
      const mapDiv = document.getElementById('map');
      mapDiv.classList.add('animated-fade');
      setTimeout(() => {
        cb(); // ë ˆì´ì–´ í† ê¸€ ë“± ì½œë°±
        mapDiv.classList.remove('animated-fade');
        mapDiv.classList.add('animated-fade-in');
        setTimeout(() => mapDiv.classList.remove('animated-fade-in'), 400);
      }, 300);
    }

    // --- GeoJSON ë ˆì´ì–´ ë¶ˆëŸ¬ì˜¤ê¸° ë° ìƒì„± (ì»¤ìŠ¤í…€ íˆ´íŒ ì ìš©) ---
    Promise.all([
      fetch('q_sd.json').then(r => r.json()),
      fetch('q_sg.json').then(r => r.json())
    ]).then(([sdJson, sgJson]) => {
      sdLayer = L.geoJSON(sdJson, {
        style: getSdStyle,
        onEachFeature: (feature, layer) => {
          // í´ë¦­ ì´ë²¤íŠ¸
          layer.on('click', () => {
            if (!sgVisible) {
              toggleSdLayerColor(layer);
              sdBorderLayer.bringToFront();
            }
          });
          // ì»¤ìŠ¤í…€ íˆ´íŒ: ì‹œë„(CTP_KOR_NM)
          if (feature.properties && feature.properties.CTP_KOR_NM) {
            const name = feature.properties.CTP_KOR_NM;
            layer.on('mouseover', e => showCustomTooltip(name, e));
            layer.on('mousemove', e => showCustomTooltip(name, e));
            layer.on('mouseout', hideCustomTooltip);
          }
        }
      }).addTo(map);

      sgLayer = L.geoJSON(sgJson, {
        style: getSgStyle,
        onEachFeature: (feature, layer) => {
          // í´ë¦­ ì´ë²¤íŠ¸
          layer.on('click', () => {
            if (sgVisible) {
              toggleSgLayerColor(layer);
              sdBorderLayer.bringToFront();
            }
          });
          // ì»¤ìŠ¤í…€ íˆ´íŒ: ì‹œêµ°(SIG_KOR_NM)
          if (feature.properties && feature.properties.SIG_KOR_NM) {
            const name = feature.properties.SIG_KOR_NM;
            layer.on('mouseover', e => showCustomTooltip(name, e));
            layer.on('mousemove', e => showCustomTooltip(name, e));
            layer.on('mouseout', hideCustomTooltip);
          }
        }
      }).addTo(map);

      sdBorderLayer = L.geoJSON(sdJson, {
        style: () => ({
          color: '#222',
          weight: parseFloat(document.getElementById('slider-sd').value),
          fillOpacity: 0,
          opacity: 1
        }),
        interactive: false
      }).addTo(map);
      sdBorderLayer.bringToFront();

      map.fitBounds(L.featureGroup([sdLayer, sgLayer, sdBorderLayer]).getBounds(), { padding: [20, 20] });

      // --- ì‹œêµ°/ì‹œë„ í† ê¸€ ë²„íŠ¼ ---
      document.getElementById('btn-sg').addEventListener('click', () => {
        animateMapFade(() => {
          sgVisible = !sgVisible;
          const btn = document.getElementById('btn-sg');
          if (sgVisible) {
            btn.textContent = 'ì‹œêµ°';
            btn.classList.add('mode-sg');
            btn.classList.remove('mode-sd');
            map.addLayer(sgLayer);
            resetSdLayerColors();
          } else {
            btn.textContent = 'ì‹œë„';
            btn.classList.add('mode-sd');
            btn.classList.remove('mode-sg');
            map.removeLayer(sgLayer);
            resetSgLayerColors();
          }
          sdBorderLayer.bringToFront();
        });
      });

      // --- ê²½ê³„ êµµê¸° ìŠ¬ë¼ì´ë” ---
      document.getElementById('slider-sd').addEventListener('input', e => {
        const w = +e.target.value;
        document.getElementById('sd-value').textContent = w.toFixed(1);
        sdBorderLayer.setStyle({ weight: w });
        sdBorderLayer.bringToFront();
      });
      document.getElementById('slider-sg').addEventListener('input', e => {
        const w = +e.target.value;
        document.getElementById('sg-value').textContent = w.toFixed(1);
        sgLayer.setStyle({ weight: w });
        sdBorderLayer.bringToFront();
      });

      // --- ì´ˆê¸°í™” ---
      document.getElementById('btn-reset').addEventListener('click', () => location.reload());

      // --- PNG ì €ì¥ (ë¯¸êµ¬í˜„ ì•ˆë‚´) ---
      document.getElementById('savePng').addEventListener('click', () => alert('ì €ì¥ ê¸°ëŠ¥ì„ ë§Œë“¤ë‹¤ê°€ ê³„ì† ì‹¤íŒ¨. ğŸ˜¢ğŸ˜¡ğŸ˜µâ€ğŸ’« [shift]+[win]+[s]ë¥¼ ì´ìš©í•´ì£¼ì„¸ìš”.'));
    });
  </script>
<footer style="position: fixed; bottom: 8px; right: 12px; font-size: 9px; color: #888; z-index: 9999; background: rgba(255,255,255,0.6); padding: 2px 6px; border-radius: 4px;">
  <a href="https://geotasoo.com" target="_blank" style="color: inherit; text-decoration: none;">@geotasoo</a>
</footer>
</body>
</html>
